2ï¸âƒ£ LAYERED ARCHITECTURE (DDD-LITE ÄÃšNG)

app/
 â”œâ”€â”€ Domain/          â† NGHIá»†P Vá»¤ THUáº¦N
 â”œâ”€â”€ Application/     â† USE CASE
 â”œâ”€â”€ Infrastructure/  â† DB / Redis / API ngoÃ i
 â””â”€â”€ Interfaces/      â† Controller / HTTP

3ï¸âƒ£ TRÃCH NHIá»†M Tá»ªNG LAYER (Ráº¤T QUAN TRá»ŒNG)

ğŸŸ¢ Domain Layer (KHÃ”NG BIáº¾T DB)
Domain/
 â”œâ”€â”€ Booking/
 â”‚    â”œâ”€â”€ Booking.php            (Entity)
 â”‚    â”œâ”€â”€ BookingStatus.php      (Enum)
 â”‚    â”œâ”€â”€ BookingPolicy.php      (Rule)
 â”‚
 â”œâ”€â”€ Pricing/
 â”‚    â”œâ”€â”€ PriceRule.php          (Domain Model)
 â”‚    â”œâ”€â”€ PricingCalculator.php  (Domain Service)
 â”‚
 â””â”€â”€ Availability/
      â”œâ”€â”€ Slot.php
      â”œâ”€â”€ SlotPolicy.php


Domain CHá»ˆ:

Validate rule

Ra quyáº¿t Ä‘á»‹nh nghiá»‡p vá»¥

Throw domain exception

âŒ KhÃ´ng query DB
âŒ KhÃ´ng biáº¿t Eloquent
ğŸŸ¡ Application Layer (ORCHESTRATION)
Application/
 â”œâ”€â”€ Booking/
 â”‚    â”œâ”€â”€ CreateBooking.php
 â”‚    â”œâ”€â”€ CancelBooking.php
 â”‚    â”œâ”€â”€ CompleteBooking.php
 â”‚
 â”œâ”€â”€ Pricing/
 â”‚    â””â”€â”€ CalculateSlotPrice.php
 â”‚
 â””â”€â”€ Availability/
      â””â”€â”€ HoldSlot.php


Application:

Gá»i Repository

Chuyá»ƒn data â†’ Domain object

Äiá»u phá»‘i flow

ğŸ‘‰ ÄÃ¢y lÃ  nÆ¡i Booking Core sá»‘ng

ğŸ”µ Infrastructure Layer (Háº  Táº¦NG)
Infrastructure/
 â”œâ”€â”€ Persistence/
 â”‚    â””â”€â”€ Repositories/
 â”‚         â”œâ”€â”€ BookingRepository.php
 â”‚         â”œâ”€â”€ SlotRepository.php
 â”‚         â””â”€â”€ PriceRuleRepository.php
 â”‚
 â”œâ”€â”€ Redis/
 â”‚    â””â”€â”€ SlotLocker.php
 â”‚
 â””â”€â”€ Payment/
      â””â”€â”€ VnPayGateway.php


ğŸ‘‰ Eloquent / Redis / API ngoÃ i chá»‰ á»Ÿ Ä‘Ã¢y

ğŸŸ£ Interfaces (HTTP)
Interfaces/
 â””â”€â”€ Http/
      â””â”€â”€ Controllers/
           â””â”€â”€ BookingController.php


Controller:

Validate request

Call Use Case

Return response

âŒ KhÃ´ng logic
âŒ KhÃ´ng query

4ï¸âƒ£ FLOW THá»°C Táº¾: Äáº¶T SÃ‚N (END-TO-END)
ğŸ§  Flow Ä‘Ãºng theo DDD-lite
[HTTP Request]
      â”‚
      â–¼
BookingController
      â”‚
      â–¼
CreateBooking (Application Use Case)
      â”‚
      â”œâ”€â–¶ SlotRepository â†’ check availability
      â”‚
      â”œâ”€â–¶ SlotLocker (Redis) â†’ hold slot
      â”‚
      â”œâ”€â–¶ PriceRuleRepository â†’ load rules
      â”‚
      â”œâ”€â–¶ PricingCalculator (Domain) â†’ tÃ­nh giÃ¡
      â”‚
      â”œâ”€â–¶ Booking (Domain Entity) â†’ validate
      â”‚
      â–¼
BookingRepository â†’ save
      â”‚
      â–¼
[Response]


ğŸ‘‰ Booking entity khÃ´ng biáº¿t Redis, DB, API
ğŸ‘‰ Pricing khÃ´ng biáº¿t Slot Ä‘áº¿n tá»« Ä‘Ã¢u